#include<SDL2/SDL.h>
#include "../include/font.h"
#include "../include/types.h"
#include "../include/pixel.h"

static i32 fonts[] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0,
    0x20, 0x60, 0x20, 0x20, 0x70,
    0xF0, 0x10, 0xF0, 0x80, 0xF0,
    0xF0, 0x10, 0xF0, 0x10, 0xF0,
    0x90, 0x90, 0xF0, 0x10, 0x10,
    0xF0, 0x80, 0xF0, 0x10, 0xF0,
    0xF0, 0x80, 0xF0, 0x90, 0xF0,
    0xF0, 0x10, 0x20, 0x40, 0x40,
    0xF0, 0x90, 0xF0, 0x90, 0xF0,
    0xF0, 0x90, 0xF0, 0x10, 0xF0,


    0x40, 0x40, 0x00, 0x40, 0x40,
    0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00,

    //A
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    //B
    0xE0, 0x90, 0xE0, 0x90, 0xE0,
    //C
    0xF0, 0x80, 0x80, 0x80, 0xF0,
    //D
    0xE0, 0x90, 0x90, 0x90, 0xE0,
    //E
    0xF0, 0x80, 0xF0, 0x80, 0xF0,
    //F
    0xF0, 0x80, 0xF0, 0x80, 0x80,
    //G
    0xF0, 0x80, 0xB0, 0x90, 0xF0,
    //H
    0x90, 0x90, 0xF0, 0x90, 0x90,
    //I
    0x60, 0x60, 0x60, 0x60, 0x60,
    //J
    0xF0, 0x20, 0x20, 0x20, 0xE0,
    //K
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
};

static i32 error_font[] = {
    0x60, 0x90, 0x20, 0x00, 0x20,
};


static int exists(u32 number) {
    // ASCII numbers
    if(number <= 9) return 1;
    // ASCII uppercase characters
    if(number <= 42) return 1;
    return 0;
}

void load_font(SDL_Surface* font_surface) {
    return;
}


static const u32 FONT_WIDTH = 5;

static void draw_number(u32 number, u32 offset, u32 color, SDL_Surface* surface){
    SDL_LockSurface(surface);

    //u32 color = 0xffffffa0;

    for(size_t y = 0; y < 5; y++) {

        i32 current = 0;

        if(exists(number)){
            current = fonts[y + (number * 5)];
        } else {
            current = error_font[y];
        }

        for(size_t x = 0; x < FONT_WIDTH; x++) {
            if( (1<<(7-x)) & current ) {
                set_pixel(surface, x + offset, y, color);
            }
        }
    }

    SDL_UnlockSurface(surface);
}

SDL_Surface* render_text(char* text, u32 color) {

    u32 size = 0;
    // Get string size
    for(;text[size]!='\0';size++);

    // First arguments (flags) my be 0 or SDL_SWSURFACE
    SDL_Surface* surface = SDL_CreateRGBSurface(0, size * FONT_WIDTH, 5, 32, 0xff000000, 0x00ff0000, 0x0000ff00, 0x000000ff);
    for(size_t i = 0; i < size; i++) {
        u32 number = 10;
        if(text[i] >= 48 ) number = text[i] - '0';
        draw_number(number, i * FONT_WIDTH, color, surface);
    }

    return surface;
}
